# frontend/nginx.conf
# This configuration is designed to serve a Single Page Application (SPA) like Vue.js
# and handle client-side routing.

server {
    listen 80;
    server_name localhost;

    # Set the root directory for serving static files.
    # This path corresponds to where the built Vue.js assets are copied in the Dockerfile.
    root /usr/share/nginx/html;

    # Define the default index files to look for when a directory is requested.
    index index.html index.htm;

    # Main location block to handle all requests
    location / {
        # This is the crucial part for SPAs.
        # It tries to serve the requested URI directly ($uri).
        # If it's a directory, it tries to serve index.html within that directory ($uri/).
        # If neither of the above works (e.g., for client-side routes like /about or /dashboard),
        # it falls back to serving /index.html. This allows your Vue.js router to
        # handle the routing on the client side.
        try_files $uri $uri/ /index.html;
    }

    # Optional: Proxy API requests to your Django backend
    # This is highly recommended to avoid CORS issues and unify API access.
    location /api/ {
        # 'django' is the service name in docker-compose, and '8000' is its port
        proxy_pass http://django:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Optional: Cache control for static assets (e.g., JS, CSS, images)
    # This can improve performance by allowing browsers to cache these files.
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|eot|ttf|woff|woff2)$ {
        expires 30d; # Cache for 30 days
        add_header Cache-Control "public, no-transform";
    }
}